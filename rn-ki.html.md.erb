---
title: PCF Metrics Release Notes and Known Issues
owner: PCF Metrics
list_style_none: true
---

This topic contains release notes for Pivotal Cloud Foundry (PCF) Metrics.

## <a id='153'></a>v1.5.3

**Release Date: January 30, 2018**

### Fixed Issues

This release fixes the following issues:

* Changes to the **Ingestor Count** field in the **Metrics Components Config** pane are applied after clicking **Apply Changes** and running the **Push PCF Metrics Components** errand. Previously, a bug in the PCF Metrics manifest file prevented changes to **Ingestor Count**.
* Locked down Postgres version for logs data storage to ensure comaptible version is installed with PCF Metrics

## <a id='151'></a>v1.5.1

**Release Date: November 26, 2018**

### Notes

The following list describes what's new in PCF Metrics v1.5.1:

* The current PCF Metrics version is now displayed on the dashboard
* Support has been added for v3 App Events
* cflinuxfs3 support added
* Now verifying that the `accept-encoding` header exists before checking its value to prevent crashes while using firewall compression
* Bug fix: Log Search was not returning matching search terms in results
* Bug fix: Reduced overly-chatty log level
* Bug fix: `logs-queue` custom metrics issue. For more information, see [Custom Metrics for `logs-queue` Not Currently Emitted](#logs-queue).

## <a id='150'></a>v1.5.0

**Release Date: September 20, 2018**

### Notes

The following list describes what's new in PCF Metrics v1.5:

* Logs data store has been updated from ElasticSearch to Postgres
* Metrics MySQL data store has been updated from MariaDB to Percona
* New feature: Application metrics and events monitors and alerting (alpha)
* New feature: Streaming metrics visualization

### <a id="issues"></a>Known Issues

The following sections describe the known issues in PCF Metrics v1.5.

#### Compatibility with Pivotal Application Service (formerly Elastic Runtime)

PCF Metrics v1.5.x requires the following versions of Pivotal Application Service: 

* PAS 2.0: v2.0.17 or later
* PAS 2.1: v2.1.8 or later
* PAS 2.2: all patches within minor
* PAS 2.3: all patches within minor

#### Upgrade Compatibility with PCF Metrics 1.4

In order to successfully run both PCF Metrics 1.4 and 1.5 simultaneously during the upgrade period, please make sure the 1.4 tile is updated to 1.4.6 or later. 1.4.5 and older will not support the secondary metrics URL (metrics-previous.YOUR-SYSTEM-DOMAIN) that allows the 1.4 dashboard to be viewed.

More information on the upgrade to 1.5 can be found [here](/pcf-metrics/1-5/installing.html#upgrade).

#### Triggered Monitor Notifications via Webhook with Proxy Settings

Metric and Event monitors will currently not send notifications to configured webhook URLs while `http_proxy` settings are enabled.

#### Ingestor Count Configuration

In PCF Metrics v1.5.0 and v1.5.1, you can configure the **Ingestor
Count** in the **Metrics Components Config** pane. Due to a bug in the Metrics
manifest file, any change to this value is not applied after an **Apply Changes** and running
the **Push PCF Metrics Components** errand.

The expected behavior is the `metrics-ingestor` app
instance count under the `system` org and `metrics-v1-5` space would scale to match the
**Ingestor Count** number configured in the tile.

#### Conflict with sysctl Job in Runtime Config

Installing PCF Metrics 1.5 might fail with an error message like the following:

<pre>
Task 31134 | 20:01:24 | Preparing deployment: Preparing deployment (00:00:01)
L Error: Colocated job 'sysctl' is already added to the instance group 'postgres'.
Task 31134 | 20:01:25 | Error: Colocated job 'sysctl' is already added to the instance group 'postgres'.
</pre>

This error occurs because, by default, PCF Metrics contains a `sysctl` job in its manifest file. There is a conflict if the `sysctl` job is also included in the BOSH `runtime-config` file. 

To prevent this error when installing PCF Metrics 1.5, first confirm that the `sysctl` job is included in the `runtime-config` file by running `bosh runtime-config`.

If the `sysctl` job is included in the `runtime-config` file, add an `include` or `exclude` rule to the `runtime-config` file to ensure the `sysctl` job is not applied to PCF Metrics deployments. 

In the example below, an `include` rule applies the `sysctl` job to the PAS tile deployment only:

<pre>
- include:
    deployments:
    - PAS-TILE-DEPLOYMENT-NAME
    stemcell:
    - os: ubuntu-trusty
    - os: ubuntu-xenial
  jobs:
  - name: sysctl
    properties:
      sysctl:
      - fs.inotify.max_user_instances=1024
      sysctl_conf_prefix: 60
    release: os-conf
  name: os-conf
</pre>

Where:

- `PAS-TILE-DEPLOYMENT-NAME` is the name of the PAS tile deployment. 

Alternatively, to apply the `sysctl` job to all tile deployments except PCF Metrics, add an `exclude` rule to the `runtime-config` file to exclude PCF Metrics deployments. 

For more information, see the [BOSH documentation](https://bosh.io/docs/runtime-config/#placement-rules).

#### Using Custom App Metrics

To use custom app metrics in PCF Metrics, you must install the Metrics Forwarder tile and bind your apps to the Metrics Forwarder service. You can use PCF Metrics without Metrics Forwarder, but you will be able to view only default container metrics, network metrics, and app events.

#### Delay in Ingesting Metrics

To prevent metrics data backup in Redis, ensure that each app does not emit more than 400 metrics per minute. For deployments with a high number of apps, you may still experience a delay of up to 1-2 hours before metrics data appears on the dashboard. 

#### Logs Data Availability During Postgres Scaling

When you vertically scale your Postgres instance in PCF Metrics 1.5, Postgres enters an unhealthy period during which it does not ingest any new logs data until the scaling operation has completed.

More information on scaling the Logs Postgres datastore can be found [here](/pcf-metrics/1-5/sizing.html#log-datastore).

#### Data Loss During Stemcell Upgrades

No metrics or logs data will be ingested during a stemcell or VM update. In tests on tile environments, stemcell updates resulted in approximately 9 minutes where logs data was not ingested.

#### Logs Data Export Limitation

Due to security, call pagination, and resource constraints, downloaded logs are limited to 10,000 log-line entries. If you need to export more logs data, we suggest looking directly at the [Loggregator Firehose](https://docs.pivotal.io/pivotalcf/loggregator/architecture.html#firehose) or utilizing the [Log Cache CLI](https://github.com/cloudfoundry/log-cache-cli).

#### <a id="logs-queue"></a> (Resolved in v1.5.1) Custom Metrics for `logs-queue` Not Currently Emitted

Custom metrics for `logs-queue` used for monitoring PCF Metrics are not available in v1.5.0-build.15. PCF Metrics v1.5.1-build.28 resolves this issue.

#### Smoke Test Failures Due to User Authentication

The PCF Metrics **Smoke Test** errand may fail if your deployment authenticates user sign-ons
with an external SAML identity provider or an external LDAP server.
In some cases, these external user stores have an additional login procedure that prevents the errand
from authenticating with the deployment and validating against the Metrics API.

If you experience this issue, disable the **Smoke Test** errand in the PCF Metrics tile and click **Apply Changes** to run the install again.

For more information about what configurations lead to this failure,
see [Configure Authentication and Enterprise SSO](http://docs.pivotal.io/pivotalcf/customizing/config-er-vmware.html#er-auth-config) in _Configuring Elastic Runtime_.

#### For Operators Who Deploy PCF Metrics Using BOSH

If both of the following are true, you might experience issues while using PCF Metrics:

* You deploy PCF Metrics using BOSH instead of using the PCF Metrics tile in Ops Manager.
* You use self-signed certificates.

Pivotal recommends using certificates issued by a Certificate Authority for BOSH deployments of this product.

#### Using PCF Metrics with Firewall Compression

Using firewall compression is known to strip out `accept-encoding` header, which will cause `req.header('accept-encoding')` to return _null_. You will need to add an HTTP header to the load balancer in order for PCF Metrics to build and run correctly.

Please note that this issue is addressed in PCF Metrics 1.5.1.

## <a id="14x"></a>Past Minor v1.4.x

Release Notes for v1.4.x releases can be found [here](http://docs.pivotal.io/pcf-metrics/1-4/rn-ki.html).

## <a id="13x"></a>Past Minor v1.3.x

Release Notes for v1.3.x releases can be found [here](http://docs.pivotal.io/pcf-metrics/1-3/rn-ki.html).

## <a id="12x"></a>Past Minor v1.2.x

Release Notes for v1.2.x releases can be found [here](http://docs.pivotal.io/pcf-metrics/1-2/rn-ki.html).

## <a id="11x"></a>Past Minor v1.1.x

Release Notes for v1.1.x releases can be found [here](http://docs.pivotal.io/pcf-metrics/1-1/rn-ki.html).

## <a id="10x"></a>Past Minor v1.0.x

Release Notes for v1.0.x releases can be found [here](http://docs.pivotal.io/pcf-metrics/1-0/rn-ki.html).
